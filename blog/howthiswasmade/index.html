<!DOCTYPE html> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=favicon.svg rel=icon type=image/svg> <script crossorigin=anonymous src=https://kit.fontawesome.com/c2a85a570d.js></script> <link href=client/main.2923210899.css rel=stylesheet><link href=client/client.26e12413.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Sapper + Svelte + CircleCI + Github Pages = Ninjatastic</title><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <nav class=svelte-1dn1lzg><ul class=svelte-1dn1lzg><li class=svelte-1dn1lzg><a href=. class=svelte-1dn1lzg>home</a></li> <li class=svelte-1dn1lzg><a href=about class=svelte-1dn1lzg>about</a></li> <li class=svelte-1dn1lzg><a href=blog class="svelte-1dn1lzg selected" rel=prefetch>blog</a></li> <li class=svelte-1dn1lzg><div class="svelte-1dn1lzg theme-switch-wrapper"><label class="svelte-1dn1lzg theme-switch" for=checkbox><input class=svelte-1dn1lzg id=checkbox type=checkbox> <div class="svelte-1dn1lzg round slider"></div></label> <em class=svelte-1dn1lzg>Become one with the shadows.</em></div></ul></nav> <main class=svelte-7hdbxu> <h1>Sapper + Svelte + CircleCI + Github Pages = Ninjatastic</h1> <h5>2019/06/12 - Cory Sabol</h5> <div class=content><h2 id=motivation>Motivation</h2> <p>Well, you see I've owned the lookoutitsa.ninja domain for a good while now. I never really got around to doing anything with it though. Then pretty recently I learned of <a href=https://sapper.svelte.dev/ >Sapper</a>. In an effort to learn Sapper and Svelte I decided that I would finally put something up on the net at lookoutitsa.ninja. As I began hacking away with Sapper + Svelte I realized that what I really wanted was a static site that allowed me to post blogs written using markdown which was deployed to Github pages for easy hosting.</p> <p>So, I built that exact thing and had a blast doing it! So, buckle up my ninja friends. This blog post is going to show you exactly how I built this very site that you're reading this post on right now :)</p> <h2 id=enter-sapper--svelte--circleci--github-pages>Enter Sapper + Svelte + CircleCI + Github Pages</h2> <p><img alt="" src=/techstacklogos.png></p> <p>For this website I wanted it to meet a few criteria:</p> <ul> <li>Be fast<ul> <li>This meant that it was likely going to need to be a static site</li> </ul> </li> <li>Be simple and clean in design</li> <li>Be easy to maintain</li> <li>Support authoring blog posts in markdown (but isn't it a static site tho? We'll get to that)</li> </ul> <p>So, having also just learned of <a href=https://svelte.dev/ >Svelte</a>, which is designed to build fast slim web UI's (the word literally means slim or slender), I decided that it might be good fit and that I would like an excuse to give it a shot. But I still needed a way to generate a static site. Well that's where <a href=https://sapper.svelte.dev/ >Sapper</a> comes into play.</p> <blockquote> <p>"Sapper is a framework for building web applications of all sizes, with a beautiful development experience and flexible filesystem-based routing."</p> </blockquote> <blockquote> <p>"Unlike single-page apps, Sapper doesn't compromise on SEO, progressive enhancement or the initial load experience — but unlike traditional server-rendered apps, navigation is instantaneous for that app-like feel."</p> </blockquote> <p>That was taken straight from the Sapper web site. So, it seems like it is intended for speed, light foot print, and also supports server-side rendering. That last part is really important as I wanted this site to be static!</p> <p>I also needed this site to be easy to maintain. For that [CircleCI] came to the rescue. It was pretty trivial to setup a simple CD pipeline which would trigger a build of the site on every commit to the master branch. You can see the config for that <a href=https://github.com/corysabol/lookoutitsa.ninja/blob/master/.circleci/config.yml>here</a> (yeah, yeah I know there is no test job as of this writing. I'm getting to it...).</p> <p>Lastly, I needed somewhere to host my static site. Preferably somewhere really cheap, or hell even free. But where would such a place possibly exist?</p> <p>...</p> <p>Github, that's where! As many of you probably know, Github provides free hosting of static content for use with it's Github Pages. This is actually perfect for my needs as I can point a domain at it and push static content to the <code>gh-pages</code> branch, and we're all good!</p> <h2 id=the-setup>The Setup</h2> <p><img alt="" src=https://media.giphy.com/media/ZFbvG2eF923te/giphy.gif></p> <p>Alright, let's get to the juicy stuff. The setup / implementation!</p> <p>Just to recap, I used the following tech stack:</p> <ul> <li><a href=https://sapper.svelte.dev/ >Sapper</a></li> <li><a href=https://svelte.dev/ >Svelte</a></li> <li><a href=https://circleci.com>CircleCI</a></li> <li><a href=https://pages.github.com/ >Github Pages</a></li> </ul> <p>This is how I implemented, automated builds and deployment, and hosted the static site.</p> <p>First I made sure that Sapper was installed:</p> <pre><code class=language-bash>npx degit <span class=hljs-string>"sveltejs/sapper-template#rollup"</span> lookoutitsa.ninja
<span class=hljs-built_in>cd</span> lookoutitsa.ninja
npm install <span class=hljs-comment># or yarn!</span>
npm run dev</code></pre> <p>This clones one of the Sapper templates so that we have a base web app to start working from, and installs all the deps, etc.</p> <p>Then because I wanted to parse markdown blog posts into html and handle some simple frontmatter metadata, I needed to install the following packages:</p> <ul> <li><a href=https://github.com/markedjs/marked>marked</a></li> <li><a href=https://github.com/nodeca/js-yaml>js-yaml</a></li> </ul> <p>After that I spent some time reading the <a href=https://sapper.svelte.dev/docs>Sapper Docs</a>, which are great.</p> <p>I also needed to make sure my domain would point to Githubs DNS servers. I used Namecheap for my domain, you can find some <a href=https://www.namecheap.com/support/knowledgebase/article.aspx/9645/2208/how-do-i-link-my-domain-to-github-pages>instructions here</a> on how to do that. YMMV though. If you're following along with this and using something other than Namecheap, just google around a bit :)</p> <p>After that I simply created a repo on Github called <a href=https://github.com/corysabol/lookoutitsa.ninja>lookoutitsa.ninja</a> and pushed my sample project to it.</p> <p>After that it was time to move into setting up the CI/CD pipeline with CircleCI.</p> <h2 id=continuous-deployment>Continuous Deployment</h2> <p>First I had to simply create an account on CircleCI, which was super easy. I just logged in using Github and configured my repo to be tracked with CircleCI. It's free for public repositories :D</p> <p>I'm going to spare myself from writing all the mundane details of getting setup with CirleCI and suggest that if you're following along, please consult the <a href=https://circleci.com/docs/2.0/oss/ >CircleCI docs on open source projects</a>.</p> <p>Let's take a look at the <code>.circleci/config.yml</code> file that I had put together for this project.</p> <pre><code class=language-yaml><span class=hljs-attr>version:</span> <span class=hljs-number>2.1</span>

<span class=hljs-attr>jobs:</span>
  <span class=hljs-attr>build:</span>
    <span class=hljs-attr>docker:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>image:</span> <span class=hljs-string>node</span>
    <span class=hljs-attr>steps:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-string>checkout</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>run:</span>
          <span class=hljs-attr>name:</span> <span class=hljs-string>build</span> <span class=hljs-string>project</span>
          <span class=hljs-attr>command:</span> <span class=hljs-string>|
            npm install
            npm run export
            cp CNAME __sapper__/export/CNAME
            cp -r .circleci/ __sapper__/export/.circleci/
            cp __sapper__/export/404/index.html __sapper__/export/404.html
</span>      <span class=hljs-bullet>-</span> <span class=hljs-attr>persist_to_workspace:</span>
          <span class=hljs-attr>root:</span> <span class=hljs-string>__sapper__</span>
          <span class=hljs-attr>paths:</span> <span class=hljs-string>export/*</span>
  <span class=hljs-attr>deploy:</span>
    <span class=hljs-attr>docker:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>image:</span> <span class=hljs-string>node</span>
    <span class=hljs-attr>steps:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-string>checkout</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>attach_workspace:</span>
          <span class=hljs-attr>at:</span> <span class=hljs-string>__sapper__</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>add_ssh_keys:</span>
          <span class=hljs-attr>fingerprints:</span>
            <span class=hljs-bullet>-</span> <span class=hljs-string>'d0:b7:4d:73:27:2b:b9:0c:8c:a1:37:4e:54:a1:b8:90'</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>run:</span>
          <span class=hljs-attr>name:</span> <span class=hljs-string>install</span> <span class=hljs-string>gh-pages</span> <span class=hljs-string>npm</span> <span class=hljs-string>package</span>
          <span class=hljs-attr>command:</span> <span class=hljs-string>|
            npm install -g --silent gh-pages
            git config user.email "ci-build@lookoutitsa.ninja"
            git config user.name "ci-build"
</span>      <span class=hljs-bullet>-</span> <span class=hljs-attr>run:</span>
          <span class=hljs-attr>Name:</span> <span class=hljs-string>Deploy</span> <span class=hljs-string>static</span> <span class=hljs-string>site</span> <span class=hljs-string>to</span> <span class=hljs-string>gh-pages</span> <span class=hljs-string>branch</span>
          <span class=hljs-attr>command:</span> <span class=hljs-string>gh-pages</span> <span class=hljs-string>-t</span> <span class=hljs-string>--dist</span> <span class=hljs-string>__sapper__/export/</span>

<span class=hljs-attr>workflows:</span>
  <span class=hljs-attr>version:</span> <span class=hljs-number>2</span>
  <span class=hljs-attr>main:</span>
    <span class=hljs-attr>jobs:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>build:</span>
          <span class=hljs-attr>filters:</span>
            <span class=hljs-attr>branches:</span>
              <span class=hljs-attr>only:</span> <span class=hljs-string>master</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>deploy:</span>
          <span class=hljs-attr>requires:</span>
            <span class=hljs-bullet>-</span> <span class=hljs-string>build</span>
          <span class=hljs-attr>filters:</span>
            <span class=hljs-attr>branches:</span>
              <span class=hljs-attr>only:</span> <span class=hljs-string>master</span></code></pre> <p>That's a decent amount to take in, so I'll break it down.</p> <p>Let's look at the first job first:</p> <pre><code class=language-yaml><span class=hljs-attr>version:</span> <span class=hljs-number>2.1</span>

<span class=hljs-attr>jobs:</span>
  <span class=hljs-attr>build:</span>
    <span class=hljs-attr>docker:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>image:</span> <span class=hljs-string>node</span>
    <span class=hljs-attr>steps:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-string>checkout</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>run:</span>
          <span class=hljs-attr>name:</span> <span class=hljs-string>build</span> <span class=hljs-string>project</span>
          <span class=hljs-attr>command:</span> <span class=hljs-string>|
            npm install
            npm run export
            cp CNAME __sapper__/export/CNAME
            cp -r .circleci/ __sapper__/export/.circleci/
            cp __sapper__/export/404/index.html __sapper__/export/404.html
</span>      <span class=hljs-bullet>-</span> <span class=hljs-attr>persist_to_workspace:</span>
          <span class=hljs-attr>root:</span> <span class=hljs-string>__sapper__</span>
          <span class=hljs-attr>paths:</span> <span class=hljs-string>export/*</span></code></pre> <p>Above you can see the <code>jobs</code> key which specifies the jobs that CircleCI should run and how to run the. Then there is the <code>build</code> job. The build job breaks down into plain English as follows:</p> <ol> <li><p>Use docker for the job environment</p> <ul> <li>Specifically use a node image</li> </ul> </li> <li><p>Run the following steps in the environment</p> <ul> <li><code>checkout</code> the git repo into our environment</li> <li>install the deps with <code>npm install</code></li> <li>build the sapper static site with <code>npm run export</code></li> <li>copy the <code>CNAME</code> file into the static export to preserve custom domain settings</li> <li>copy the <code>circleci</code> configuration to the static export to make sure branch whitelists work</li> <li>copy the exported <code>404/index.html</code> file to the root of the export as <code>404.html</code><ul> <li>this allows the github pages 404 page to be overidden with our own</li> </ul> </li> <li>next <code>persist</code> the dir <code>__sapper__/export/*</code> to the workspace to be used in the next job<ul> <li>This is so that we have the static files available to the next job for deployment</li> </ul> </li> </ul> </li> </ol> <p>Alright, now we can move on to the second job, <code>deploy</code>:</p> <pre><code class=language-yaml><span class=hljs-attr>deploy:</span>
  <span class=hljs-attr>docker:</span>
    <span class=hljs-bullet>-</span> <span class=hljs-attr>image:</span> <span class=hljs-string>node</span>
  <span class=hljs-attr>steps:</span>
    <span class=hljs-bullet>-</span> <span class=hljs-string>checkout</span>
    <span class=hljs-bullet>-</span> <span class=hljs-attr>attach_workspace:</span>
        <span class=hljs-attr>at:</span> <span class=hljs-string>__sapper__</span>
    <span class=hljs-bullet>-</span> <span class=hljs-attr>add_ssh_keys:</span>
        <span class=hljs-attr>fingerprints:</span>
          <span class=hljs-bullet>-</span> <span class=hljs-string>'d0:b7:4d:73:27:2b:b9:0c:8c:a1:37:4e:54:a1:b8:90'</span>
    <span class=hljs-bullet>-</span> <span class=hljs-attr>run:</span>
        <span class=hljs-attr>name:</span> <span class=hljs-string>install</span> <span class=hljs-string>gh-pages</span> <span class=hljs-string>npm</span> <span class=hljs-string>package</span>
        <span class=hljs-attr>command:</span> <span class=hljs-string>|
          npm install -g --silent gh-pages
          git config user.email "ci-build@lookoutitsa.ninja"
          git config user.name "ci-build"
</span>    <span class=hljs-bullet>-</span> <span class=hljs-attr>run:</span>
        <span class=hljs-attr>Name:</span> <span class=hljs-string>Deploy</span> <span class=hljs-string>static</span> <span class=hljs-string>site</span> <span class=hljs-string>to</span> <span class=hljs-string>gh-pages</span> <span class=hljs-string>branch</span>
        <span class=hljs-attr>command:</span> <span class=hljs-string>gh-pages</span> <span class=hljs-string>-t</span> <span class=hljs-string>--dist</span> <span class=hljs-string>__sapper__/export/</span></code></pre> <p>I'll break the above job down into plain English like before:</p> <ol> <li><p>Use docker for the job environment</p> <ul> <li>Specfically use a node image</li> </ul> </li> <li><p>Run the following steps in the environment</p> <ul> <li><code>checkout</code> the git repo into out environment</li> <li><code>attach</code> the previously persisted directory to the <code>__sapper__</code> dir</li> <li>specify the <code>ssh key</code> to use based on it's fingerprint<ul> <li>please refer to the <a href=https://circleci.com/docs/2.0/gh-bb-integration/#enable-your-project-to-check-out-additional-private-repositories>CircleCI docs</a> on how to set up a key pair for your project</li> </ul> </li> <li>install a npm package called <code>gh-pages</code><ul> <li>This makes it easier to deploy static assets to a repos gh-pages branch</li> </ul> </li> <li>configure the <code>git email</code> and <code>git username</code></li> <li>Run the <code>gh-pages</code> tool with <code>-t</code> to make sure hidden files get pushed as well<ul> <li>this is important so that the <code>.circleci</code> dir will get pushed</li> <li>this command pushes the files found in <code>__sapper__/export</code> to the <code>gh-pages</code> branch</li> </ul> </li> </ul> </li> </ol> <p>Phew, okay let's hurry onto the last part!</p> <pre><code class=language-yaml><span class=hljs-attr>workflows:</span>
  <span class=hljs-attr>version:</span> <span class=hljs-number>2</span>
  <span class=hljs-attr>main:</span>
    <span class=hljs-attr>jobs:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>build:</span>
          <span class=hljs-attr>filters:</span>
            <span class=hljs-attr>branches:</span>
              <span class=hljs-attr>only:</span> <span class=hljs-string>master</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>deploy:</span>
          <span class=hljs-attr>requires:</span>
            <span class=hljs-bullet>-</span> <span class=hljs-string>build</span>
          <span class=hljs-attr>filters:</span>
            <span class=hljs-attr>branches:</span>
              <span class=hljs-attr>only:</span> <span class=hljs-string>master</span></code></pre> <p>The yaml above simply defines the order in which to run the jobs and for which branches to run them. You can see that I have this workflow to only execute for the <code>master</code> branch.</p> <p>That's really it for setting up the continuous deployment of the site. Pretty simple, which is how I like it!</p> <h2 id=markdown-blog-posts-with-frontmatter>Markdown Blog Posts with Frontmatter</h2> <p>Alright, so this is something that I really like about this setup. The ability to write my posts in markdown and then have them be compiled to HTML as part of the site's build process. Sapper makes this pretty easy to accomplish.</p> <p>Let's look at the following file - <code>src/routes/blog/_posts.js</code></p> <pre><code class=language-js><span class=hljs-comment>// This file is called `_posts.js` rather than `posts.js`, because</span>
<span class=hljs-comment>// we don't want to create an `/blog/posts` route — the leading</span>
<span class=hljs-comment>// underscore tells Sapper not to do that.</span>

<span class=hljs-keyword>import</span> fs <span class=hljs-keyword>from</span> <span class=hljs-string>'fs'</span>;
<span class=hljs-keyword>import</span> path <span class=hljs-keyword>from</span> <span class=hljs-string>'path'</span>;
<span class=hljs-keyword>import</span> marked <span class=hljs-keyword>from</span> <span class=hljs-string>'marked'</span>;
<span class=hljs-keyword>import</span> yaml <span class=hljs-keyword>from</span> <span class=hljs-string>'js-yaml'</span>;
<span class=hljs-keyword>import</span> hljs <span class=hljs-keyword>from</span> <span class=hljs-string>'highlight.js'</span>;

<span class=hljs-keyword>const</span> parseFrontMatter = <span class=hljs-function><span class=hljs-params>text</span> =></span> {
  <span class=hljs-keyword>const</span> regex = <span class=hljs-regexp>/@@@@@\n*(.*?)\n*@@@@@\n*(.*)/gm</span>s;
  <span class=hljs-keyword>const</span> match = regex.exec(text);
  <span class=hljs-keyword>const</span> frontMatter = match[<span class=hljs-number>1</span>];
  <span class=hljs-keyword>const</span> body = match[<span class=hljs-number>2</span>];
  <span class=hljs-comment>// parse the front matter to json</span>
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>frontMatter</span>: yaml.safeLoad(frontMatter),
    <span class=hljs-attr>markdown</span>: body,
  };
};

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> () =>
  fs
    .readdirSync(<span class=hljs-string>`content/posts`</span>)
    .filter(<span class=hljs-function><span class=hljs-params>file</span> =></span> file[<span class=hljs-number>0</span>] !== <span class=hljs-string>'.'</span> && path.extname(file) === <span class=hljs-string>'.md'</span>)
    .map(<span class=hljs-function><span class=hljs-params>file</span> =></span> {
      <span class=hljs-keyword>const</span> markdown = fs.readFileSync(<span class=hljs-string>`content/posts/<span class=hljs-subst>${file}</span>`</span>, <span class=hljs-string>'utf-8'</span>);
      <span class=hljs-comment>//const { content, metadata } = process_markdown(markdown);</span>
      <span class=hljs-comment>//TODO syntax highlighting</span>

      <span class=hljs-comment>// Parse the front matter</span>
      <span class=hljs-keyword>const</span> parsed = parseFrontMatter(markdown);

      marked.setOptions({
        <span class=hljs-attr>gfm</span>: <span class=hljs-literal>true</span>,
        <span class=hljs-attr>headerIds</span>: <span class=hljs-literal>true</span>,
        <span class=hljs-attr>highlight</span>: <span class=hljs-function>(<span class=hljs-params>code, lang</span>) =></span> {
          <span class=hljs-built_in>console</span>.log(hljs.highlight(lang, code).value);
          <span class=hljs-keyword>return</span> hljs.highlight(lang, code).value;
        },
      });

      <span class=hljs-keyword>const</span> html = marked(parsed.markdown);
      <span class=hljs-keyword>return</span> {
        <span class=hljs-attr>title</span>: parsed.frontMatter.title,
        <span class=hljs-attr>date</span>: parsed.frontMatter.date,
        <span class=hljs-attr>summary</span>: parsed.frontMatter.summary,
        <span class=hljs-attr>author</span>: parsed.frontMatter.author,
        html,
        <span class=hljs-attr>slug</span>: file.replace(<span class=hljs-regexp>/^\d+-/</span>, <span class=hljs-string>''</span>).replace(<span class=hljs-regexp>/\.md$/</span>, <span class=hljs-string>''</span>),
        file,
      };
    });</code></pre> <p>I'm not going to break that one down part by part because I'm lazy. But I will explain why it's named like it is and what exactly it does.</p> <p>First off the file is named <code>_posts.js</code> and placed under <code>src/routes/blog/</code>. The directory simply allows this file to be colocated with the Svelte templates that use it. The name <code>_posts.js</code> is important in that the <code>_</code> tells Sapper not to build the file as a URL route. See <a href=https://sapper.svelte.dev/docs#Routing>Sapper routing</a>.</p> <p>The code in this file reads in all markdown files under <code>content/posts</code> in the project repo and parses some custom frontMatter metadata about the post out of the file by grabbing the yaml between the two <code>@@@@@</code> lines. Then it uses <code>marked</code> and <code>hightlight.js</code> to parse the markdown to HTML and provide syntax highlight for the code blocks.</p> <p>Finally, it returns a list of objects which contain the fronMatter metadata, the html content, the URL slug, and the filename.</p> <p>A sample markdown blog post looks like the following:</p> <pre><code class=language-md>@@@@@
title: "title"
date: "yyyy/mm/dd"
author: "Author Name"
summary: "Summary of the post"
@@@@@

<span class=hljs-section>## Markdown post content here</span></code></pre> <p>I think that the frontMatter fields are pretty self explanatory :)</p> <p>Okay, the next file that is important to the blog posts working the way that they do is the <code>src/routes/blog/[slug].json.js</code> file.</p> <pre><code class=language-js><span class=hljs-keyword>import</span> posts <span class=hljs-keyword>from</span> <span class=hljs-string>'./_posts.js'</span>;

<span class=hljs-keyword>const</span> lookup = <span class=hljs-keyword>new</span> <span class=hljs-built_in>Map</span>();
posts().forEach(<span class=hljs-function><span class=hljs-params>post</span> =></span> {
  lookup.set(post.slug, <span class=hljs-built_in>JSON</span>.stringify(post));
});

<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>get</span>(<span class=hljs-params>req, res, next</span>) </span>{
  <span class=hljs-keyword>const</span> {slug} = req.params;

  <span class=hljs-keyword>if</span> (lookup.has(slug)) {
    res.writeHead(<span class=hljs-number>200</span>, {
      <span class=hljs-string>'Content-Type'</span>: <span class=hljs-string>'application/json'</span>,
    });
    res.end(lookup.get(slug));
  }
  <span class=hljs-comment>// don't need to res 404 here because we bake to static</span>
  <span class=hljs-comment>// and the server will catch a 404 and handle it.</span>
}</code></pre> <p>This bit of code does a few things and again has a pretty important name. The name <code>[slug].json.js</code> means that Sapper will make the URL slug value available to the JS in this file post build. The URL slug is simply the ending value of the restful URL. So, something like <code>/blogs/myawesomepost</code> would result in a slug value of <code>myawesomepost</code> being made available to the context of that JavaScript code.</p> <p>With that knowledge I can move on to explaining what the file does. It imports the previously discussed <code>_posts.js</code> file and then constructs a map of each of the parsed markdown posts where the key value of the map is the filename of the post without the file extension on it. It then exports an <code>async</code> function called <code>get</code> which uses the <code>slug</code> value to lookup the proper blog post by the url slug and then returns a JSON string representation of the post. The cool thing about this is that when Sapper builds the application it will compile this code into a route within <code>server.js</code> which will then act as a REST API to the client side code for retrieving specific blog posts. Neato!</p> <p>Lastly I want to show the <code>src/routes/blog/[slug].svelte</code> file, which is the HTML template which handles rendering the blog post data. Again, just like the last file the URL <code>slug</code> is made available to this file.</p> <pre><code class=language-html><span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
  <span class=hljs-keyword>import</span> Post <span class=hljs-keyword>from</span> <span class=hljs-string>'../../components/Post.svelte'</span>;
  <span class=hljs-keyword>import</span> {onMount} <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;

  <span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params>{params, query}</span>) </span>{
    <span class=hljs-keyword>const</span> {slug} = params;

    <span class=hljs-keyword>const</span> res = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.fetch(<span class=hljs-string>`blog/<span class=hljs-subst>${slug}</span>.json`</span>);

    <span class=hljs-keyword>if</span> (res.status === <span class=hljs-number>200</span>) {
      <span class=hljs-keyword>const</span> content = <span class=hljs-keyword>await</span> res.json();
      <span class=hljs-keyword>return</span> {content};
    }

    <span class=hljs-keyword>this</span>.error(<span class=hljs-number>404</span>, <span class=hljs-string>'No dice, Ace.'</span>);
  }
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> content;
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>svelte:head</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>title</span>></span>{content.title}<span class=hljs-tag>&lt;/<span class=hljs-name>title</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>svelte:head</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>Post</span> <span class=hljs-attr>content</span>=<span class=hljs-string>"{content}"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>Post</span>></span></code></pre> <p>The code in the top most <code>&lt;script></code> tags of this file simply exports a function called <code>Preload</code> which Sapper will use to fetch the blog JSON data from the file previously described using the <code>slug</code> value and set it into a module level value called <code>content</code> which is exposed in the second <code>&lt;script></code> tags. This content object is then passed to a simple component called Post which uses the data within it's HTML content.</p> <p>Now that's all well and good, but none of this is actually static. Sapper generated a <code>server.js</code> file which is intnded to be used as the backend of the app. That won't work for hosting on Github Pages! That's okay though, when the build job runs the <code>npm run export</code> command Sapper builds the app and hosts the server locally and then crawls the app for all linked content and exports it to static files. So, as long as a page is reachable by <code>&lt;a></code> tags within the app it will get exported to a static file :D Pretty damn cool if you ask me.</p> <p>That wraps up how the markdown blog posts are rendered as part of the site build step, so let's move on to how I actually author new posts for the site.</p> <h2 id=authoring-blog-posts>Authoring Blog Posts</h2> <p>Writing new posts is really simple. I just fire up my favorite editor, which happens to be vim, and I create a new branch for working on the post. Then I create a new markdown file or edit a previous one under the <code>content/posts/</code> dir of the project. Once I'm done working I can push that up to github for safe keeping and then whenever I'm ready for it be published to the site, I can just merge the branch into master, which triggers the jobs in CircleCI, thus building a new version of the static site and pushing it to the <code>gh-pages</code> branch. Pow, easy peasy.</p> <h2 id=conclusion>Conclusion</h2> <p>Obviously, this is not the most user friendly way of doing something like this, and it requires a new build every time I want to change something. Also, if I want to keep posts in a github branch as I'm working on the content, the post is public while in a draft state through the repo itself.</p> <p>However, none of these are really issues for me, and I'm really happy with this setup and with Sapper and Svelte. They are awesome tools that deliver an enjoyable dev experience.</p> <p>I also recognize that there are a ton of other blog post out there about how to use Github Pages as a bloggin platform and that the concepts here are really nothing new. But I did not find much out there about how to use the awesome Sapper and Svelte to create such a web page. If you're curious you can view the source for this site <a href=https://github.com/corysabol/lookoutitsa.ninja>here</a>.</p> <p>There's still a lot I want to do with this project such as:</p> <ul> <li>implement a better night / dark theme</li> <li>imporove the CSS styling and overall visual design</li> <li>implement non-invasive, non-tracking (no cookies), analytics<ul> <li>basically just page views, I may do this with an AWS lambda and some other stuff</li> </ul> </li> <li>and many more fun things</li> </ul> <p>Thanks for reading, fellow Ninja.</p> </div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{content:{title:"Sapper + Svelte + CircleCI + Github Pages = Ninjatastic",date:"2019\u002F06\u002F12",summary:"Have you ever wanted to build a static web site with Sapper + Svelte + CircleCI + Github Pages? Well have I got just the thing for you.",author:"Cory Sabol",html:"\u003Ch2 id=\"motivation\"\u003EMotivation\u003C\u002Fh2\u003E\n\u003Cp\u003EWell, you see I&#39;ve owned the lookoutitsa.ninja domain for a good while now.\nI never really got around to doing anything with it though. Then pretty recently I learned of\n\u003Ca href=\"https:\u002F\u002Fsapper.svelte.dev\u002F\"\u003ESapper\u003C\u002Fa\u003E. In an effort to learn Sapper and Svelte I decided that I would finally put something up on\nthe net at lookoutitsa.ninja. As I began hacking away with Sapper + Svelte I realized that what I really\nwanted was a static site that allowed me to post blogs written using markdown which was deployed to\nGithub pages for easy hosting.\u003C\u002Fp\u003E\n\u003Cp\u003ESo, I built that exact thing and had a blast doing it! So, buckle up my ninja friends. This blog post\nis going to show you exactly how I built this very site that you&#39;re reading this post on right now :)\u003C\u002Fp\u003E\n\u003Ch2 id=\"enter-sapper--svelte--circleci--github-pages\"\u003EEnter Sapper + Svelte + CircleCI + Github Pages\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Ftechstacklogos.png\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EFor this website I wanted it to meet a few criteria:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EBe fast\u003Cul\u003E\n\u003Cli\u003EThis meant that it was likely going to need to be a static site\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003EBe simple and clean in design\u003C\u002Fli\u003E\n\u003Cli\u003EBe easy to maintain\u003C\u002Fli\u003E\n\u003Cli\u003ESupport authoring blog posts in markdown (but isn&#39;t it a static site tho? We&#39;ll get to that)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003ESo, having also just learned of \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002F\"\u003ESvelte\u003C\u002Fa\u003E, which is designed to build fast slim web UI&#39;s (the word literally means slim or slender), I decided that it might be good fit and that I would like an excuse to give it a shot. But I still needed a way to generate a static site. Well that&#39;s where \u003Ca href=\"https:\u002F\u002Fsapper.svelte.dev\u002F\"\u003ESapper\u003C\u002Fa\u003E comes into play.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E&quot;Sapper is a framework for building web applications of all sizes, with a beautiful development experience and flexible filesystem-based routing.&quot;\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E&quot;Unlike single-page apps, Sapper doesn&#39;t compromise on SEO, progressive enhancement or the initial load experience — but unlike traditional server-rendered apps, navigation is instantaneous for that app-like feel.&quot;\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003EThat was taken straight from the Sapper web site. So, it seems like it is intended for speed, light foot print, and also supports server-side rendering. That last part is really important as I wanted this site to be static!\u003C\u002Fp\u003E\n\u003Cp\u003EI also needed this site to be easy to maintain. For that [CircleCI] came to the rescue. It was pretty trivial to setup a simple CD pipeline which would trigger a build of the site on every commit to the master branch. You can see the config for that \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcorysabol\u002Flookoutitsa.ninja\u002Fblob\u002Fmaster\u002F.circleci\u002Fconfig.yml\"\u003Ehere\u003C\u002Fa\u003E (yeah, yeah I know there is no test job as of this writing. I&#39;m getting to it...).\u003C\u002Fp\u003E\n\u003Cp\u003ELastly, I needed somewhere to host my static site. Preferably somewhere really cheap, or hell even free. But where would such a place possibly exist?\u003C\u002Fp\u003E\n\u003Cp\u003E...\u003C\u002Fp\u003E\n\u003Cp\u003EGithub, that&#39;s where! As many of you probably know, Github provides free hosting of static content for use with it&#39;s Github Pages. This is actually perfect for my needs as I can point a domain at it and push static content to the \u003Ccode\u003Egh-pages\u003C\u002Fcode\u003E branch, and we&#39;re all good!\u003C\u002Fp\u003E\n\u003Ch2 id=\"the-setup\"\u003EThe Setup\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fmedia.giphy.com\u002Fmedia\u002FZFbvG2eF923te\u002Fgiphy.gif\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAlright, let&#39;s get to the juicy stuff. The setup \u002F implementation!\u003C\u002Fp\u003E\n\u003Cp\u003EJust to recap, I used the following tech stack:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fsapper.svelte.dev\u002F\"\u003ESapper\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002F\"\u003ESvelte\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fcircleci.com\"\u003ECircleCI\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fpages.github.com\u002F\"\u003EGithub Pages\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EThis is how I implemented, automated builds and deployment, and hosted the static site.\u003C\u002Fp\u003E\n\u003Cp\u003EFirst I made sure that Sapper was installed:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Enpx degit \u003Cspan class=\"hljs-string\"\u003E\"sveltejs\u002Fsapper-template#rollup\"\u003C\u002Fspan\u003E lookoutitsa.ninja\n\u003Cspan class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E lookoutitsa.ninja\nnpm install \u003Cspan class=\"hljs-comment\"\u003E# or yarn!\u003C\u002Fspan\u003E\nnpm run dev\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThis clones one of the Sapper templates so that we have a base web app to start working from, and installs all the deps, etc.\u003C\u002Fp\u003E\n\u003Cp\u003EThen because I wanted to parse markdown blog posts into html and handle some simple frontmatter metadata, I needed to install the following packages:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmarkedjs\u002Fmarked\"\u003Emarked\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fnodeca\u002Fjs-yaml\"\u003Ejs-yaml\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EAfter that I spent some time reading the \u003Ca href=\"https:\u002F\u002Fsapper.svelte.dev\u002Fdocs\"\u003ESapper Docs\u003C\u002Fa\u003E, which are great.\u003C\u002Fp\u003E\n\u003Cp\u003EI also needed to make sure my domain would point to Githubs DNS servers. I used Namecheap for my domain, you can find some \u003Ca href=\"https:\u002F\u002Fwww.namecheap.com\u002Fsupport\u002Fknowledgebase\u002Farticle.aspx\u002F9645\u002F2208\u002Fhow-do-i-link-my-domain-to-github-pages\"\u003Einstructions here\u003C\u002Fa\u003E on how to do that. YMMV though. If you&#39;re following along with this and using something other than Namecheap, just google around a bit :)\u003C\u002Fp\u003E\n\u003Cp\u003EAfter that I simply created a repo on Github called \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcorysabol\u002Flookoutitsa.ninja\"\u003Elookoutitsa.ninja\u003C\u002Fa\u003E and pushed my sample project to it.\u003C\u002Fp\u003E\n\u003Cp\u003EAfter that it was time to move into setting up the CI\u002FCD pipeline with CircleCI.\u003C\u002Fp\u003E\n\u003Ch2 id=\"continuous-deployment\"\u003EContinuous Deployment\u003C\u002Fh2\u003E\n\u003Cp\u003EFirst I had to simply create an account on CircleCI, which was super easy. I just logged in using Github and configured my repo to be tracked with CircleCI. It&#39;s free for public repositories :D\u003C\u002Fp\u003E\n\u003Cp\u003EI&#39;m going to spare myself from writing all the mundane details of getting setup with CirleCI and suggest that if you&#39;re following along, please consult the \u003Ca href=\"https:\u002F\u002Fcircleci.com\u002Fdocs\u002F2.0\u002Foss\u002F\"\u003ECircleCI docs on open source projects\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003ELet&#39;s take a look at the \u003Ccode\u003E.circleci\u002Fconfig.yml\u003C\u002Fcode\u003E file that I had put together for this project.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-yaml\"\u003E\u003Cspan class=\"hljs-attr\"\u003Eversion:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E2.1\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-attr\"\u003Ejobs:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Ebuild:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Edocker:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eimage:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enode\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Esteps:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Echeckout\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ebuild\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eproject\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ecommand:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E|\n            npm install\n            npm run export\n            cp CNAME __sapper__\u002Fexport\u002FCNAME\n            cp -r .circleci\u002F __sapper__\u002Fexport\u002F.circleci\u002F\n            cp __sapper__\u002Fexport\u002F404\u002Findex.html __sapper__\u002Fexport\u002F404.html\n\u003C\u002Fspan\u003E      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Epersist_to_workspace:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Eroot:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Epaths:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eexport\u002F*\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Edeploy:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Edocker:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eimage:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enode\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Esteps:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Echeckout\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eattach_workspace:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Eat:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eadd_ssh_keys:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Efingerprints:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'd0:b7:4d:73:27:2b:b9:0c:8c:a1:37:4e:54:a1:b8:90'\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Einstall\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enpm\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Epackage\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ecommand:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E|\n            npm install -g --silent gh-pages\n            git config user.email \"ci-build@lookoutitsa.ninja\"\n            git config user.name \"ci-build\"\n\u003C\u002Fspan\u003E      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003EName:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EDeploy\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Esite\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ebranch\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ecommand:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E-t\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E--dist\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u002Fexport\u002F\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-attr\"\u003Eworkflows:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Eversion:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Emain:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Ejobs:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebuild:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Efilters:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-attr\"\u003Ebranches:\u003C\u002Fspan\u003E\n              \u003Cspan class=\"hljs-attr\"\u003Eonly:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Emaster\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Edeploy:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Erequires:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ebuild\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Efilters:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-attr\"\u003Ebranches:\u003C\u002Fspan\u003E\n              \u003Cspan class=\"hljs-attr\"\u003Eonly:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Emaster\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThat&#39;s a decent amount to take in, so I&#39;ll break it down.\u003C\u002Fp\u003E\n\u003Cp\u003ELet&#39;s look at the first job first:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-yaml\"\u003E\u003Cspan class=\"hljs-attr\"\u003Eversion:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E2.1\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-attr\"\u003Ejobs:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Ebuild:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Edocker:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eimage:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enode\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Esteps:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Echeckout\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ebuild\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eproject\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Ecommand:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E|\n            npm install\n            npm run export\n            cp CNAME __sapper__\u002Fexport\u002FCNAME\n            cp -r .circleci\u002F __sapper__\u002Fexport\u002F.circleci\u002F\n            cp __sapper__\u002Fexport\u002F404\u002Findex.html __sapper__\u002Fexport\u002F404.html\n\u003C\u002Fspan\u003E      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Epersist_to_workspace:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Eroot:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Epaths:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eexport\u002F*\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EAbove you can see the \u003Ccode\u003Ejobs\u003C\u002Fcode\u003E key which specifies the jobs that CircleCI should run and\nhow to run the. Then there is the \u003Ccode\u003Ebuild\u003C\u002Fcode\u003E job. The build job breaks down into plain English as follows:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003EUse docker for the job environment\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003ESpecifically use a node image\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003ERun the following steps in the environment\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Echeckout\u003C\u002Fcode\u003E the git repo into our environment\u003C\u002Fli\u003E\n\u003Cli\u003Einstall the deps with \u003Ccode\u003Enpm install\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003Ebuild the sapper static site with \u003Ccode\u003Enpm run export\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003Ecopy the \u003Ccode\u003ECNAME\u003C\u002Fcode\u003E file into the static export to preserve custom domain settings\u003C\u002Fli\u003E\n\u003Cli\u003Ecopy the \u003Ccode\u003Ecircleci\u003C\u002Fcode\u003E configuration to the static export to make sure branch whitelists work\u003C\u002Fli\u003E\n\u003Cli\u003Ecopy the exported \u003Ccode\u003E404\u002Findex.html\u003C\u002Fcode\u003E file to the root of the export as \u003Ccode\u003E404.html\u003C\u002Fcode\u003E\u003Cul\u003E\n\u003Cli\u003Ethis allows the github pages 404 page to be overidden with our own\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003Enext \u003Ccode\u003Epersist\u003C\u002Fcode\u003E the dir \u003Ccode\u003E__sapper__\u002Fexport\u002F*\u003C\u002Fcode\u003E to the workspace to be used in the next job\u003Cul\u003E\n\u003Cli\u003EThis is so that we have the static files available to the next job for deployment\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003EAlright, now we can move on to the second job, \u003Ccode\u003Edeploy\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-yaml\"\u003E\u003Cspan class=\"hljs-attr\"\u003Edeploy:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Edocker:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eimage:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enode\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Esteps:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Echeckout\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eattach_workspace:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Eat:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eadd_ssh_keys:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Efingerprints:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'd0:b7:4d:73:27:2b:b9:0c:8c:a1:37:4e:54:a1:b8:90'\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Einstall\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enpm\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Epackage\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Ecommand:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E|\n          npm install -g --silent gh-pages\n          git config user.email \"ci-build@lookoutitsa.ninja\"\n          git config user.name \"ci-build\"\n\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003EName:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EDeploy\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Esite\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eto\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ebranch\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Ecommand:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E-t\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E--dist\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u002Fexport\u002F\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EI&#39;ll break the above job down into plain English like before:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003EUse docker for the job environment\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003ESpecfically use a node image\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003ERun the following steps in the environment\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Echeckout\u003C\u002Fcode\u003E the git repo into out environment\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eattach\u003C\u002Fcode\u003E the previously persisted directory to the \u003Ccode\u003E__sapper__\u003C\u002Fcode\u003E dir\u003C\u002Fli\u003E\n\u003Cli\u003Especify the \u003Ccode\u003Essh key\u003C\u002Fcode\u003E to use based on it&#39;s fingerprint\u003Cul\u003E\n\u003Cli\u003Eplease refer to the \u003Ca href=\"https:\u002F\u002Fcircleci.com\u002Fdocs\u002F2.0\u002Fgh-bb-integration\u002F#enable-your-project-to-check-out-additional-private-repositories\"\u003ECircleCI docs\u003C\u002Fa\u003E on how to set up a key pair for your project\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003Einstall a npm package called \u003Ccode\u003Egh-pages\u003C\u002Fcode\u003E\u003Cul\u003E\n\u003Cli\u003EThis makes it easier to deploy static assets to a repos gh-pages branch\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003Econfigure the \u003Ccode\u003Egit email\u003C\u002Fcode\u003E and \u003Ccode\u003Egit username\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003ERun the \u003Ccode\u003Egh-pages\u003C\u002Fcode\u003E tool with \u003Ccode\u003E-t\u003C\u002Fcode\u003E to make sure hidden files get pushed as well\u003Cul\u003E\n\u003Cli\u003Ethis is important so that the \u003Ccode\u003E.circleci\u003C\u002Fcode\u003E dir will get pushed\u003C\u002Fli\u003E\n\u003Cli\u003Ethis command pushes the files found in \u003Ccode\u003E__sapper__\u002Fexport\u003C\u002Fcode\u003E to the \u003Ccode\u003Egh-pages\u003C\u002Fcode\u003E branch\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003EPhew, okay let&#39;s hurry onto the last part!\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-yaml\"\u003E\u003Cspan class=\"hljs-attr\"\u003Eworkflows:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Eversion:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Emain:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Ejobs:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebuild:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Efilters:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-attr\"\u003Ebranches:\u003C\u002Fspan\u003E\n              \u003Cspan class=\"hljs-attr\"\u003Eonly:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Emaster\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Edeploy:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Erequires:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ebuild\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Efilters:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hljs-attr\"\u003Ebranches:\u003C\u002Fspan\u003E\n              \u003Cspan class=\"hljs-attr\"\u003Eonly:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Emaster\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe yaml above simply defines the order in which to run the jobs and for which branches to run them. You can see that I have this workflow to only execute for the \u003Ccode\u003Emaster\u003C\u002Fcode\u003E branch.\u003C\u002Fp\u003E\n\u003Cp\u003EThat&#39;s really it for setting up the continuous deployment of the site. Pretty simple, which is how I like it!\u003C\u002Fp\u003E\n\u003Ch2 id=\"markdown-blog-posts-with-frontmatter\"\u003EMarkdown Blog Posts with Frontmatter\u003C\u002Fh2\u003E\n\u003Cp\u003EAlright, so this is something that I really like about this setup. The ability to write my posts in markdown and then have them be compiled to HTML as part of the site&#39;s build process. Sapper makes this pretty easy to accomplish.\u003C\u002Fp\u003E\n\u003Cp\u003ELet&#39;s look at the following file - \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F_posts.js\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F This file is called `_posts.js` rather than `posts.js`, because\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F we don't want to create an `\u002Fblog\u002Fposts` route — the leading\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F underscore tells Sapper not to do that.\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E fs \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'fs'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E path \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'path'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E marked \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'marked'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E yaml \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'js-yaml'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E hljs \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'highlight.js'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E parseFrontMatter = \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Etext\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E regex = \u003Cspan class=\"hljs-regexp\"\u003E\u002F@@@@@\\n*(.*?)\\n*@@@@@\\n*(.*)\u002Fgm\u003C\u002Fspan\u003Es;\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E match = regex.exec(text);\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E frontMatter = match[\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E];\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E body = match[\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E];\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F parse the front matter to json\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-attr\"\u003EfrontMatter\u003C\u002Fspan\u003E: yaml.safeLoad(frontMatter),\n    \u003Cspan class=\"hljs-attr\"\u003Emarkdown\u003C\u002Fspan\u003E: body,\n  };\n};\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E () =&gt;\n  fs\n    .readdirSync(\u003Cspan class=\"hljs-string\"\u003E`content\u002Fposts`\u003C\u002Fspan\u003E)\n    .filter(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Efile\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E file[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E] !== \u003Cspan class=\"hljs-string\"\u003E'.'\u003C\u002Fspan\u003E &amp;&amp; path.extname(file) === \u003Cspan class=\"hljs-string\"\u003E'.md'\u003C\u002Fspan\u003E)\n    .map(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Efile\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n      \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E markdown = fs.readFileSync(\u003Cspan class=\"hljs-string\"\u003E`content\u002Fposts\u002F\u003Cspan class=\"hljs-subst\"\u003E${file}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E'utf-8'\u003C\u002Fspan\u003E);\n      \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002Fconst { content, metadata } = process_markdown(markdown);\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002FTODO syntax highlighting\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Parse the front matter\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E parsed = parseFrontMatter(markdown);\n\n      marked.setOptions({\n        \u003Cspan class=\"hljs-attr\"\u003Egfm\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E,\n        \u003Cspan class=\"hljs-attr\"\u003EheaderIds\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E,\n        \u003Cspan class=\"hljs-attr\"\u003Ehighlight\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Ecode, lang\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\n          \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(hljs.highlight(lang, code).value);\n          \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E hljs.highlight(lang, code).value;\n        },\n      });\n\n      \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E html = marked(parsed.markdown);\n      \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E {\n        \u003Cspan class=\"hljs-attr\"\u003Etitle\u003C\u002Fspan\u003E: parsed.frontMatter.title,\n        \u003Cspan class=\"hljs-attr\"\u003Edate\u003C\u002Fspan\u003E: parsed.frontMatter.date,\n        \u003Cspan class=\"hljs-attr\"\u003Esummary\u003C\u002Fspan\u003E: parsed.frontMatter.summary,\n        \u003Cspan class=\"hljs-attr\"\u003Eauthor\u003C\u002Fspan\u003E: parsed.frontMatter.author,\n        html,\n        \u003Cspan class=\"hljs-attr\"\u003Eslug\u003C\u002Fspan\u003E: file.replace(\u003Cspan class=\"hljs-regexp\"\u003E\u002F^\\d+-\u002F\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E''\u003C\u002Fspan\u003E).replace(\u003Cspan class=\"hljs-regexp\"\u003E\u002F\\.md$\u002F\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E''\u003C\u002Fspan\u003E),\n        file,\n      };\n    });\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EI&#39;m not going to break that one down part by part because I&#39;m lazy. But I will explain why it&#39;s named like it is and what exactly it does.\u003C\u002Fp\u003E\n\u003Cp\u003EFirst off the file is named \u003Ccode\u003E_posts.js\u003C\u002Fcode\u003E and placed under \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F\u003C\u002Fcode\u003E. The directory simply allows this file to be colocated with the Svelte templates that use it. The name \u003Ccode\u003E_posts.js\u003C\u002Fcode\u003E is important in that the \u003Ccode\u003E_\u003C\u002Fcode\u003E tells Sapper not to build the file as a URL route. See \u003Ca href=\"https:\u002F\u002Fsapper.svelte.dev\u002Fdocs#Routing\"\u003ESapper routing\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EThe code in this file reads in all markdown files under \u003Ccode\u003Econtent\u002Fposts\u003C\u002Fcode\u003E in the project repo and parses some custom frontMatter metadata about the post out of the file by grabbing the yaml between the two \u003Ccode\u003E@@@@@\u003C\u002Fcode\u003E lines. Then it uses \u003Ccode\u003Emarked\u003C\u002Fcode\u003E and \u003Ccode\u003Ehightlight.js\u003C\u002Fcode\u003E to parse the markdown to HTML and provide syntax highlight for the code blocks.\u003C\u002Fp\u003E\n\u003Cp\u003EFinally, it returns a list of objects which contain the fronMatter metadata, the html content, the URL slug, and the filename.\u003C\u002Fp\u003E\n\u003Cp\u003EA sample markdown blog post looks like the following:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-md\"\u003E@@@@@\ntitle: \"title\"\ndate: \"yyyy\u002Fmm\u002Fdd\"\nauthor: \"Author Name\"\nsummary: \"Summary of the post\"\n@@@@@\n\n\u003Cspan class=\"hljs-section\"\u003E## Markdown post content here\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EI think that the frontMatter fields are pretty self explanatory :)\u003C\u002Fp\u003E\n\u003Cp\u003EOkay, the next file that is important to the blog posts working the way that they do is the \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].json.js\u003C\u002Fcode\u003E file.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E posts \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'.\u002F_posts.js'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E lookup = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EMap\u003C\u002Fspan\u003E();\nposts().forEach(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Epost\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n  lookup.set(post.slug, \u003Cspan class=\"hljs-built_in\"\u003EJSON\u003C\u002Fspan\u003E.stringify(post));\n});\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eget\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res, next\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E {slug} = req.params;\n\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (lookup.has(slug)) {\n    res.writeHead(\u003Cspan class=\"hljs-number\"\u003E200\u003C\u002Fspan\u003E, {\n      \u003Cspan class=\"hljs-string\"\u003E'Content-Type'\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E'application\u002Fjson'\u003C\u002Fspan\u003E,\n    });\n    res.end(lookup.get(slug));\n  }\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F don't need to res 404 here because we bake to static\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F and the server will catch a 404 and handle it.\u003C\u002Fspan\u003E\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThis bit of code does a few things and again has a pretty important name. The name \u003Ccode\u003E[slug].json.js\u003C\u002Fcode\u003E means that Sapper will make the URL slug value available to the JS in this file post build. The URL slug is simply the ending value of the restful URL. So, something like \u003Ccode\u003E\u002Fblogs\u002Fmyawesomepost\u003C\u002Fcode\u003E would result in a slug value of \u003Ccode\u003Emyawesomepost\u003C\u002Fcode\u003E being made available to the context of that JavaScript code.\u003C\u002Fp\u003E\n\u003Cp\u003EWith that knowledge I can move on to explaining what the file does. It imports the previously discussed \u003Ccode\u003E_posts.js\u003C\u002Fcode\u003E file and then constructs a map of each of the parsed markdown posts where the key value of the map is the filename of the post without the file extension on it. It then exports an \u003Ccode\u003Easync\u003C\u002Fcode\u003E function called \u003Ccode\u003Eget\u003C\u002Fcode\u003E which uses the \u003Ccode\u003Eslug\u003C\u002Fcode\u003E value to lookup the proper blog post by the url slug and then returns a JSON string representation of the post. The cool thing about this is that when Sapper builds the application it will compile this code into a route within \u003Ccode\u003Eserver.js\u003C\u002Fcode\u003E which will then act as a REST API to the client side code for retrieving specific blog posts. Neato!\u003C\u002Fp\u003E\n\u003Cp\u003ELastly I want to show the \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].svelte\u003C\u002Fcode\u003E file, which is the HTML template which handles rendering the blog post data. Again, just like the last file the URL \u003Ccode\u003Eslug\u003C\u002Fcode\u003E is made available to this file.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E Post \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'..\u002F..\u002Fcomponents\u002FPost.svelte'\u003C\u002Fspan\u003E;\n  \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E {onMount} \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'svelte'\u003C\u002Fspan\u003E;\n\n  \u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E{params, query}\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E {slug} = params;\n\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E res = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.fetch(\u003Cspan class=\"hljs-string\"\u003E`blog\u002F\u003Cspan class=\"hljs-subst\"\u003E${slug}\u003C\u002Fspan\u003E.json`\u003C\u002Fspan\u003E);\n\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (res.status === \u003Cspan class=\"hljs-number\"\u003E200\u003C\u002Fspan\u003E) {\n      \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E content = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E res.json();\n      \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E {content};\n    }\n\n    \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.error(\u003Cspan class=\"hljs-number\"\u003E404\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E'No dice, Ace.'\u003C\u002Fspan\u003E);\n  }\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E content;\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{content.title}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003EPost\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtent\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"{content}\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003EPost\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThe code in the top most \u003Ccode\u003E&lt;script&gt;\u003C\u002Fcode\u003E tags of this file simply exports a function called \u003Ccode\u003EPreload\u003C\u002Fcode\u003E which Sapper will use to fetch the blog JSON data from the file previously described using the \u003Ccode\u003Eslug\u003C\u002Fcode\u003E value and set it into a module level value called \u003Ccode\u003Econtent\u003C\u002Fcode\u003E which is exposed in the second \u003Ccode\u003E&lt;script&gt;\u003C\u002Fcode\u003E tags. This content object is then passed to a simple component called Post which uses the data within it&#39;s HTML content.\u003C\u002Fp\u003E\n\u003Cp\u003ENow that&#39;s all well and good, but none of this is actually static. Sapper generated a \u003Ccode\u003Eserver.js\u003C\u002Fcode\u003E file which is intnded to be used as the backend of the app. That won&#39;t work for hosting on Github Pages! That&#39;s okay though, when the build job runs the \u003Ccode\u003Enpm run export\u003C\u002Fcode\u003E command Sapper builds the app and hosts the server locally and then crawls the app for all linked content and exports it to static files. So, as long as a page is reachable by \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E tags within the app it will get exported to a static file :D Pretty damn cool if you ask me.\u003C\u002Fp\u003E\n\u003Cp\u003EThat wraps up how the markdown blog posts are rendered as part of the site build step, so let&#39;s move on to how I actually author new posts for the site.\u003C\u002Fp\u003E\n\u003Ch2 id=\"authoring-blog-posts\"\u003EAuthoring Blog Posts\u003C\u002Fh2\u003E\n\u003Cp\u003EWriting new posts is really simple. I just fire up my favorite editor, which happens to be vim, and I create a new branch for working on the post. Then I create a new markdown file or edit a previous one under the \u003Ccode\u003Econtent\u002Fposts\u002F\u003C\u002Fcode\u003E dir of the project. Once I&#39;m done working I can push that up to github for safe keeping and then whenever I&#39;m ready for it be published to the site, I can just merge the branch into master, which triggers the jobs in CircleCI, thus building a new version of the static site and pushing it to the \u003Ccode\u003Egh-pages\u003C\u002Fcode\u003E branch. Pow, easy peasy.\u003C\u002Fp\u003E\n\u003Ch2 id=\"conclusion\"\u003EConclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EObviously, this is not the most user friendly way of doing something like this, and it requires a new build every time I want to change something. Also, if I want to keep posts in a github branch as I&#39;m working on the content, the post is public while in a draft state through the repo itself.\u003C\u002Fp\u003E\n\u003Cp\u003EHowever, none of these are really issues for me, and I&#39;m really happy with this setup and with Sapper and Svelte. They are awesome tools that deliver an enjoyable dev experience.\u003C\u002Fp\u003E\n\u003Cp\u003EI also recognize that there are a ton of other blog post out there about how to use Github Pages as a bloggin platform and that the concepts here are really nothing new. But I did not find much out there about how to use the awesome Sapper and Svelte to create such a web page. If you&#39;re curious you can view the source for this site \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcorysabol\u002Flookoutitsa.ninja\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EThere&#39;s still a lot I want to do with this project such as:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Eimplement a better night \u002F dark theme\u003C\u002Fli\u003E\n\u003Cli\u003Eimporove the CSS styling and overall visual design\u003C\u002Fli\u003E\n\u003Cli\u003Eimplement non-invasive, non-tracking (no cookies), analytics\u003Cul\u003E\n\u003Cli\u003Ebasically just page views, I may do this with an AWS lambda and some other stuff\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003Eand many more fun things\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EThanks for reading, fellow Ninja.\u003C\u002Fp\u003E\n",slug:"howthiswasmade",file:"howthiswasmade.md"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.26e12413.js"}catch(e){main="/client/legacy/client.bab2aab5.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 