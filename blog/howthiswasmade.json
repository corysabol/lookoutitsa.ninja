{"title":"Sapper + Svelte + CircleCI + Github Pages = Ninjatastic","date":"2019/06/12","summary":"Have you ever wanted to build a static web site with Sapper + Svelte + CircleCI + Github Pages? Well have I got just the thing for you.","author":"Cory Sabol","html":"<h2 id=\"motivation\">Motivation</h2>\n<p>Well, you see I&#39;ve owned the lookoutitsa.ninja domain for a good while now.\nI never really got around to doing anything with it though. Then pretty recently I learned of\n<a href=\"https://sapper.svelte.dev/\">Sapper</a>. In an effort to learn Sapper and Svelte I decided that I would finally put something up on\nthe net at lookoutitsa.ninja. As I began hacking away with Sapper + Svelte I realized that what I really\nwanted was a static site that allowed me to post blogs written using markdown which was deployed to\nGithub pages for easy hosting.</p>\n<p>So, I built that exact thing and had a blast doing it! So, buckle up my ninja friends. This blog post\nis going to show you exactly how I built this very site that you&#39;re reading this post on right now :)</p>\n<h2 id=\"enter-sapper--svelte--circleci--github-pages\">Enter Sapper + Svelte + CircleCI + Github Pages</h2>\n<p><img src=\"/techstacklogos.png\" alt=\"\"></p>\n<p>For this website I wanted it to meet a few criteria:</p>\n<ul>\n<li>Be fast<ul>\n<li>This meant that it was likely going to need to be a static site</li>\n</ul>\n</li>\n<li>Be simple and clean in design</li>\n<li>Be easy to maintain</li>\n<li>Support authoring blog posts in markdown (but isn&#39;t it a static site tho? We&#39;ll get to that)</li>\n</ul>\n<p>So, having also just learned of <a href=\"https://svelte.dev/\">Svelte</a>, which is designed to build fast slim web UI&#39;s (the word literally means slim or slender), I decided that it might be good fit and that I would like an excuse to give it a shot. But I still needed a way to generate a static site. Well that&#39;s where <a href=\"https://sapper.svelte.dev/\">Sapper</a> comes into play.</p>\n<blockquote>\n<p>&quot;Sapper is a framework for building web applications of all sizes, with a beautiful development experience and flexible filesystem-based routing.&quot;</p>\n</blockquote>\n<blockquote>\n<p>&quot;Unlike single-page apps, Sapper doesn&#39;t compromise on SEO, progressive enhancement or the initial load experience â€” but unlike traditional server-rendered apps, navigation is instantaneous for that app-like feel.&quot;</p>\n</blockquote>\n<p>That was taken straight from the Sapper web site. So, it seems like it is intended for speed, light foot print, and also supports server-side rendering. That last part is really important as I wanted this site to be static!</p>\n<p>I also needed this site to be easy to maintain. For that [CircleCI] came to the rescue. It was pretty trivial to setup a simple CD pipeline which would trigger a build of the site on every commit to the master branch. You can see the config for that <a href=\"https://github.com/corysabol/lookoutitsa.ninja/blob/master/.circleci/config.yml\">here</a> (yeah, yeah I know there is no test job as of this writing. I&#39;m getting to it...).</p>\n<p>Lastly, I needed somewhere to host my static site. Preferably somewhere really cheap, or hell even free. But where would such a place possibly exist?</p>\n<p>...</p>\n<p>Github, that&#39;s where! As many of you probably know, Github provides free hosting of static content for use with it&#39;s Github Pages. This is actually perfect for my needs as I can point a domain at it and push static content to the <code>gh-pages</code> branch, and we&#39;re all good!</p>\n<h2 id=\"the-setup\">The Setup</h2>\n<p><img src=\"https://media.giphy.com/media/ZFbvG2eF923te/giphy.gif\" alt=\"\"></p>\n<p>Alright, let&#39;s get to the juicy stuff. The setup / implementation!</p>\n<p>Just to recap, I used the following tech stack:</p>\n<ul>\n<li><a href=\"https://sapper.svelte.dev/\">Sapper</a></li>\n<li><a href=\"https://svelte.dev/\">Svelte</a></li>\n<li><a href=\"https://circleci.com\">CircleCI</a></li>\n<li><a href=\"https://pages.github.com/\">Github Pages</a></li>\n</ul>\n<p>This is how I implemented, automated builds and deployment, and hosted the static site.</p>\n<p>First I made sure that Sapper was installed:</p>\n<pre><code class=\"language-bash\">npx degit <span class=\"hljs-string\">\"sveltejs/sapper-template#rollup\"</span> lookoutitsa.ninja\n<span class=\"hljs-built_in\">cd</span> lookoutitsa.ninja\nnpm install <span class=\"hljs-comment\"># or yarn!</span>\nnpm run dev</code></pre>\n<p>This clones one of the Sapper templates so that we have a base web app to start working from, and installs all the deps, etc.</p>\n<p>Then because I wanted to parse markdown blog posts into html and handle some simple frontmatter metadata, I needed to install the following packages:</p>\n<ul>\n<li><a href=\"https://github.com/markedjs/marked\">marked</a></li>\n<li><a href=\"https://github.com/nodeca/js-yaml\">js-yaml</a></li>\n</ul>\n<p>After that I spent some time reading the <a href=\"https://sapper.svelte.dev/docs\">Sapper Docs</a>, which are great.</p>\n<p>I also needed to make sure my domain would point to Githubs DNS servers. I used Namecheap for my domain, you can find some <a href=\"https://www.namecheap.com/support/knowledgebase/article.aspx/9645/2208/how-do-i-link-my-domain-to-github-pages\">instructions here</a> on how to do that. YMMV though. If you&#39;re following along with this and using something other than Namecheap, just google around a bit :)</p>\n<p>After that I simply created a repo on Github called <a href=\"https://github.com/corysabol/lookoutitsa.ninja\">lookoutitsa.ninja</a> and pushed my sample project to it.</p>\n<p>After that it was time to move into setting up the CI/CD pipeline with CircleCI.</p>\n<h2 id=\"continuous-deployment\">Continuous Deployment</h2>\n<p>First I had to simply create an account on CircleCI, which was super easy. I just logged in using Github and configured my repo to be tracked with CircleCI. It&#39;s free for public repositories :D</p>\n<p>I&#39;m going to spare myself from writing all the mundane details of getting setup with CirleCI and suggest that if you&#39;re following along, please consult the <a href=\"https://circleci.com/docs/2.0/oss/\">CircleCI docs on open source projects</a>.</p>\n<p>Let&#39;s take a look at the <code>.circleci/config.yml</code> file that I had put together for this project.</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2.1</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">build:</span>\n    <span class=\"hljs-attr\">docker:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">node</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">checkout</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span>\n          <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">build</span> <span class=\"hljs-string\">project</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">|\n            npm install\n            npm run export\n            cp CNAME __sapper__/export/CNAME\n            cp -r .circleci/ __sapper__/export/.circleci/\n            cp __sapper__/export/404/index.html __sapper__/export/404.html\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">persist_to_workspace:</span>\n          <span class=\"hljs-attr\">root:</span> <span class=\"hljs-string\">__sapper__</span>\n          <span class=\"hljs-attr\">paths:</span> <span class=\"hljs-string\">export/*</span>\n  <span class=\"hljs-attr\">deploy:</span>\n    <span class=\"hljs-attr\">docker:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">node</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">checkout</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">attach_workspace:</span>\n          <span class=\"hljs-attr\">at:</span> <span class=\"hljs-string\">__sapper__</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">add_ssh_keys:</span>\n          <span class=\"hljs-attr\">fingerprints:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">'d0:b7:4d:73:27:2b:b9:0c:8c:a1:37:4e:54:a1:b8:90'</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span>\n          <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">gh-pages</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">package</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">|\n            npm install -g --silent gh-pages\n            git config user.email \"ci-build@lookoutitsa.ninja\"\n            git config user.name \"ci-build\"\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span>\n          <span class=\"hljs-attr\">Name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">static</span> <span class=\"hljs-string\">site</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">gh-pages</span> <span class=\"hljs-string\">branch</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">gh-pages</span> <span class=\"hljs-string\">-t</span> <span class=\"hljs-string\">--dist</span> <span class=\"hljs-string\">__sapper__/export/</span>\n\n<span class=\"hljs-attr\">workflows:</span>\n  <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2</span>\n  <span class=\"hljs-attr\">main:</span>\n    <span class=\"hljs-attr\">jobs:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">build:</span>\n          <span class=\"hljs-attr\">filters:</span>\n            <span class=\"hljs-attr\">branches:</span>\n              <span class=\"hljs-attr\">only:</span> <span class=\"hljs-string\">master</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">deploy:</span>\n          <span class=\"hljs-attr\">requires:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">build</span>\n          <span class=\"hljs-attr\">filters:</span>\n            <span class=\"hljs-attr\">branches:</span>\n              <span class=\"hljs-attr\">only:</span> <span class=\"hljs-string\">master</span></code></pre>\n<p>That&#39;s a decent amount to take in, so I&#39;ll break it down.</p>\n<p>Let&#39;s look at the first job first:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2.1</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">build:</span>\n    <span class=\"hljs-attr\">docker:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">node</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">checkout</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span>\n          <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">build</span> <span class=\"hljs-string\">project</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">|\n            npm install\n            npm run export\n            cp CNAME __sapper__/export/CNAME\n            cp -r .circleci/ __sapper__/export/.circleci/\n            cp __sapper__/export/404/index.html __sapper__/export/404.html\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">persist_to_workspace:</span>\n          <span class=\"hljs-attr\">root:</span> <span class=\"hljs-string\">__sapper__</span>\n          <span class=\"hljs-attr\">paths:</span> <span class=\"hljs-string\">export/*</span></code></pre>\n<p>Above you can see the <code>jobs</code> key which specifies the jobs that CircleCI should run and\nhow to run the. Then there is the <code>build</code> job. The build job breaks down into plain English as follows:</p>\n<ol>\n<li><p>Use docker for the job environment</p>\n<ul>\n<li>Specifically use a node image</li>\n</ul>\n</li>\n<li><p>Run the following steps in the environment</p>\n<ul>\n<li><code>checkout</code> the git repo into our environment</li>\n<li>install the deps with <code>npm install</code></li>\n<li>build the sapper static site with <code>npm run export</code></li>\n<li>copy the <code>CNAME</code> file into the static export to preserve custom domain settings</li>\n<li>copy the <code>circleci</code> configuration to the static export to make sure branch whitelists work</li>\n<li>copy the exported <code>404/index.html</code> file to the root of the export as <code>404.html</code><ul>\n<li>this allows the github pages 404 page to be overidden with our own</li>\n</ul>\n</li>\n<li>next <code>persist</code> the dir <code>__sapper__/export/*</code> to the workspace to be used in the next job<ul>\n<li>This is so that we have the static files available to the next job for deployment</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<p>Alright, now we can move on to the second job, <code>deploy</code>:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">deploy:</span>\n  <span class=\"hljs-attr\">docker:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">node</span>\n  <span class=\"hljs-attr\">steps:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">checkout</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">attach_workspace:</span>\n        <span class=\"hljs-attr\">at:</span> <span class=\"hljs-string\">__sapper__</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">add_ssh_keys:</span>\n        <span class=\"hljs-attr\">fingerprints:</span>\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">'d0:b7:4d:73:27:2b:b9:0c:8c:a1:37:4e:54:a1:b8:90'</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span>\n        <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">gh-pages</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">package</span>\n        <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">|\n          npm install -g --silent gh-pages\n          git config user.email \"ci-build@lookoutitsa.ninja\"\n          git config user.name \"ci-build\"\n</span>    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span>\n        <span class=\"hljs-attr\">Name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">static</span> <span class=\"hljs-string\">site</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">gh-pages</span> <span class=\"hljs-string\">branch</span>\n        <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">gh-pages</span> <span class=\"hljs-string\">-t</span> <span class=\"hljs-string\">--dist</span> <span class=\"hljs-string\">__sapper__/export/</span></code></pre>\n<p>I&#39;ll break the above job down into plain English like before:</p>\n<ol>\n<li><p>Use docker for the job environment</p>\n<ul>\n<li>Specfically use a node image</li>\n</ul>\n</li>\n<li><p>Run the following steps in the environment</p>\n<ul>\n<li><code>checkout</code> the git repo into out environment</li>\n<li><code>attach</code> the previously persisted directory to the <code>__sapper__</code> dir</li>\n<li>specify the <code>ssh key</code> to use based on it&#39;s fingerprint<ul>\n<li>please refer to the <a href=\"https://circleci.com/docs/2.0/gh-bb-integration/#enable-your-project-to-check-out-additional-private-repositories\">CircleCI docs</a> on how to set up a key pair for your project</li>\n</ul>\n</li>\n<li>install a npm package called <code>gh-pages</code><ul>\n<li>This makes it easier to deploy static assets to a repos gh-pages branch</li>\n</ul>\n</li>\n<li>configure the <code>git email</code> and <code>git username</code></li>\n<li>Run the <code>gh-pages</code> tool with <code>-t</code> to make sure hidden files get pushed as well<ul>\n<li>this is important so that the <code>.circleci</code> dir will get pushed</li>\n<li>this command pushes the files found in <code>__sapper__/export</code> to the <code>gh-pages</code> branch</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<p>Phew, okay let&#39;s hurry onto the last part!</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">workflows:</span>\n  <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2</span>\n  <span class=\"hljs-attr\">main:</span>\n    <span class=\"hljs-attr\">jobs:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">build:</span>\n          <span class=\"hljs-attr\">filters:</span>\n            <span class=\"hljs-attr\">branches:</span>\n              <span class=\"hljs-attr\">only:</span> <span class=\"hljs-string\">master</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">deploy:</span>\n          <span class=\"hljs-attr\">requires:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">build</span>\n          <span class=\"hljs-attr\">filters:</span>\n            <span class=\"hljs-attr\">branches:</span>\n              <span class=\"hljs-attr\">only:</span> <span class=\"hljs-string\">master</span></code></pre>\n<p>The yaml above simply defines the order in which to run the jobs and for which branches to run them. You can see that I have this workflow to only execute for the <code>master</code> branch.</p>\n<p>That&#39;s really it for setting up the continuous deployment of the site. Pretty simple, which is how I like it!</p>\n<h2 id=\"markdown-blog-posts-with-frontmatter\">Markdown Blog Posts with Frontmatter</h2>\n<p>Alright, so this is something that I really like about this setup. The ability to write my posts in markdown and then have them be compiled to HTML as part of the site&#39;s build process. Sapper makes this pretty easy to accomplish.</p>\n<p>Let&#39;s look at the following file - <code>src/routes/blog/_posts.js</code></p>\n<pre><code class=\"language-js\"><span class=\"hljs-comment\">// This file is called `_posts.js` rather than `posts.js`, because</span>\n<span class=\"hljs-comment\">// we don't want to create an `/blog/posts` route â€” the leading</span>\n<span class=\"hljs-comment\">// underscore tells Sapper not to do that.</span>\n\n<span class=\"hljs-keyword\">import</span> fs <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'fs'</span>;\n<span class=\"hljs-keyword\">import</span> path <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'path'</span>;\n<span class=\"hljs-keyword\">import</span> marked <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'marked'</span>;\n<span class=\"hljs-keyword\">import</span> yaml <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'js-yaml'</span>;\n<span class=\"hljs-keyword\">import</span> hljs <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'highlight.js'</span>;\n\n<span class=\"hljs-keyword\">const</span> parseFrontMatter = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> {\n  <span class=\"hljs-keyword\">const</span> regex = <span class=\"hljs-regexp\">/@@@@@\\n*(.*?)\\n*@@@@@\\n*(.*)/gm</span>s;\n  <span class=\"hljs-keyword\">const</span> match = regex.exec(text);\n  <span class=\"hljs-keyword\">const</span> frontMatter = match[<span class=\"hljs-number\">1</span>];\n  <span class=\"hljs-keyword\">const</span> body = match[<span class=\"hljs-number\">2</span>];\n  <span class=\"hljs-comment\">// parse the front matter to json</span>\n  <span class=\"hljs-keyword\">return</span> {\n    <span class=\"hljs-attr\">frontMatter</span>: yaml.safeLoad(frontMatter),\n    <span class=\"hljs-attr\">markdown</span>: body,\n  };\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> () =&gt;\n  fs\n    .readdirSync(<span class=\"hljs-string\">`content/posts`</span>)\n    .filter(<span class=\"hljs-function\"><span class=\"hljs-params\">file</span> =&gt;</span> file[<span class=\"hljs-number\">0</span>] !== <span class=\"hljs-string\">'.'</span> &amp;&amp; path.extname(file) === <span class=\"hljs-string\">'.md'</span>)\n    .map(<span class=\"hljs-function\"><span class=\"hljs-params\">file</span> =&gt;</span> {\n      <span class=\"hljs-keyword\">const</span> markdown = fs.readFileSync(<span class=\"hljs-string\">`content/posts/<span class=\"hljs-subst\">${file}</span>`</span>, <span class=\"hljs-string\">'utf-8'</span>);\n      <span class=\"hljs-comment\">//const { content, metadata } = process_markdown(markdown);</span>\n      <span class=\"hljs-comment\">//TODO syntax highlighting</span>\n\n      <span class=\"hljs-comment\">// Parse the front matter</span>\n      <span class=\"hljs-keyword\">const</span> parsed = parseFrontMatter(markdown);\n\n      marked.setOptions({\n        <span class=\"hljs-attr\">gfm</span>: <span class=\"hljs-literal\">true</span>,\n        <span class=\"hljs-attr\">headerIds</span>: <span class=\"hljs-literal\">true</span>,\n        <span class=\"hljs-attr\">highlight</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">code, lang</span>) =&gt;</span> {\n          <span class=\"hljs-built_in\">console</span>.log(hljs.highlight(lang, code).value);\n          <span class=\"hljs-keyword\">return</span> hljs.highlight(lang, code).value;\n        },\n      });\n\n      <span class=\"hljs-keyword\">const</span> html = marked(parsed.markdown);\n      <span class=\"hljs-keyword\">return</span> {\n        <span class=\"hljs-attr\">title</span>: parsed.frontMatter.title,\n        <span class=\"hljs-attr\">date</span>: parsed.frontMatter.date,\n        <span class=\"hljs-attr\">summary</span>: parsed.frontMatter.summary,\n        <span class=\"hljs-attr\">author</span>: parsed.frontMatter.author,\n        html,\n        <span class=\"hljs-attr\">slug</span>: file.replace(<span class=\"hljs-regexp\">/^\\d+-/</span>, <span class=\"hljs-string\">''</span>).replace(<span class=\"hljs-regexp\">/\\.md$/</span>, <span class=\"hljs-string\">''</span>),\n        file,\n      };\n    });</code></pre>\n<p>I&#39;m not going to break that one down part by part because I&#39;m lazy. But I will explain why it&#39;s named like it is and what exactly it does.</p>\n<p>First off the file is named <code>_posts.js</code> and placed under <code>src/routes/blog/</code>. The directory simply allows this file to be colocated with the Svelte templates that use it. The name <code>_posts.js</code> is important in that the <code>_</code> tells Sapper not to build the file as a URL route. See <a href=\"https://sapper.svelte.dev/docs#Routing\">Sapper routing</a>.</p>\n<p>The code in this file reads in all markdown files under <code>content/posts</code> in the project repo and parses some custom frontMatter metadata about the post out of the file by grabbing the yaml between the two <code>@@@@@</code> lines. Then it uses <code>marked</code> and <code>hightlight.js</code> to parse the markdown to HTML and provide syntax highlight for the code blocks.</p>\n<p>Finally, it returns a list of objects which contain the fronMatter metadata, the html content, the URL slug, and the filename.</p>\n<p>A sample markdown blog post looks like the following:</p>\n<pre><code class=\"language-md\">@@@@@\ntitle: \"title\"\ndate: \"yyyy/mm/dd\"\nauthor: \"Author Name\"\nsummary: \"Summary of the post\"\n@@@@@\n\n<span class=\"hljs-section\">## Markdown post content here</span></code></pre>\n<p>I think that the frontMatter fields are pretty self explanatory :)</p>\n<p>Okay, the next file that is important to the blog posts working the way that they do is the <code>src/routes/blog/[slug].json.js</code> file.</p>\n<pre><code class=\"language-js\"><span class=\"hljs-keyword\">import</span> posts <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./_posts.js'</span>;\n\n<span class=\"hljs-keyword\">const</span> lookup = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Map</span>();\nposts().forEach(<span class=\"hljs-function\"><span class=\"hljs-params\">post</span> =&gt;</span> {\n  lookup.set(post.slug, <span class=\"hljs-built_in\">JSON</span>.stringify(post));\n});\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">get</span>(<span class=\"hljs-params\">req, res, next</span>) </span>{\n  <span class=\"hljs-keyword\">const</span> {slug} = req.params;\n\n  <span class=\"hljs-keyword\">if</span> (lookup.has(slug)) {\n    res.writeHead(<span class=\"hljs-number\">200</span>, {\n      <span class=\"hljs-string\">'Content-Type'</span>: <span class=\"hljs-string\">'application/json'</span>,\n    });\n    res.end(lookup.get(slug));\n  }\n  <span class=\"hljs-comment\">// don't need to res 404 here because we bake to static</span>\n  <span class=\"hljs-comment\">// and the server will catch a 404 and handle it.</span>\n}</code></pre>\n<p>This bit of code does a few things and again has a pretty important name. The name <code>[slug].json.js</code> means that Sapper will make the URL slug value available to the JS in this file post build. The URL slug is simply the ending value of the restful URL. So, something like <code>/blogs/myawesomepost</code> would result in a slug value of <code>myawesomepost</code> being made available to the context of that JavaScript code.</p>\n<p>With that knowledge I can move on to explaining what the file does. It imports the previously discussed <code>_posts.js</code> file and then constructs a map of each of the parsed markdown posts where the key value of the map is the filename of the post without the file extension on it. It then exports an <code>async</code> function called <code>get</code> which uses the <code>slug</code> value to lookup the proper blog post by the url slug and then returns a JSON string representation of the post. The cool thing about this is that when Sapper builds the application it will compile this code into a route within <code>server.js</code> which will then act as a REST API to the client side code for retrieving specific blog posts. Neato!</p>\n<p>Lastly I want to show the <code>src/routes/blog/[slug].svelte</code> file, which is the HTML template which handles rendering the blog post data. Again, just like the last file the URL <code>slug</code> is made available to this file.</p>\n<pre><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">context</span>=<span class=\"hljs-string\">\"module\"</span>&gt;</span><span class=\"javascript\">\n  <span class=\"hljs-keyword\">import</span> Post <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../../components/Post.svelte'</span>;\n  <span class=\"hljs-keyword\">import</span> {onMount} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'svelte'</span>;\n\n  <span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">preload</span>(<span class=\"hljs-params\">{params, query}</span>) </span>{\n    <span class=\"hljs-keyword\">const</span> {slug} = params;\n\n    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-keyword\">this</span>.fetch(<span class=\"hljs-string\">`blog/<span class=\"hljs-subst\">${slug}</span>.json`</span>);\n\n    <span class=\"hljs-keyword\">if</span> (res.status === <span class=\"hljs-number\">200</span>) {\n      <span class=\"hljs-keyword\">const</span> content = <span class=\"hljs-keyword\">await</span> res.json();\n      <span class=\"hljs-keyword\">return</span> {content};\n    }\n\n    <span class=\"hljs-keyword\">this</span>.error(<span class=\"hljs-number\">404</span>, <span class=\"hljs-string\">'No dice, Ace.'</span>);\n  }\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n  <span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">let</span> content;\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svelte:head</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>{content.title}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">svelte:head</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Post</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"{content}\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Post</span>&gt;</span></code></pre>\n<p>The code in the top most <code>&lt;script&gt;</code> tags of this file simply exports a function called <code>Preload</code> which Sapper will use to fetch the blog JSON data from the file previously described using the <code>slug</code> value and set it into a module level value called <code>content</code> which is exposed in the second <code>&lt;script&gt;</code> tags. This content object is then passed to a simple component called Post which uses the data within it&#39;s HTML content.</p>\n<p>Now that&#39;s all well and good, but none of this is actually static. Sapper generated a <code>server.js</code> file which is intnded to be used as the backend of the app. That won&#39;t work for hosting on Github Pages! That&#39;s okay though, when the build job runs the <code>npm run export</code> command Sapper builds the app and hosts the server locally and then crawls the app for all linked content and exports it to static files. So, as long as a page is reachable by <code>&lt;a&gt;</code> tags within the app it will get exported to a static file :D Pretty damn cool if you ask me.</p>\n<p>That wraps up how the markdown blog posts are rendered as part of the site build step, so let&#39;s move on to how I actually author new posts for the site.</p>\n<h2 id=\"authoring-blog-posts\">Authoring Blog Posts</h2>\n<p>Writing new posts is really simple. I just fire up my favorite editor, which happens to be vim, and I create a new branch for working on the post. Then I create a new markdown file or edit a previous one under the <code>content/posts/</code> dir of the project. Once I&#39;m done working I can push that up to github for safe keeping and then whenever I&#39;m ready for it be published to the site, I can just merge the branch into master, which triggers the jobs in CircleCI, thus building a new version of the static site and pushing it to the <code>gh-pages</code> branch. Pow, easy peasy.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Obviously, this is not the most user friendly way of doing something like this, and it requires a new build every time I want to change something. Also, if I want to keep posts in a github branch as I&#39;m working on the content, the post is public while in a draft state through the repo itself.</p>\n<p>However, none of these are really issues for me, and I&#39;m really happy with this setup and with Sapper and Svelte. They are awesome tools that deliver an enjoyable dev experience.</p>\n<p>I also recognize that there are a ton of other blog post out there about how to use Github Pages as a bloggin platform and that the concepts here are really nothing new. But I did not find much out there about how to use the awesome Sapper and Svelte to create such a web page. If you&#39;re curious you can view the source for this site <a href=\"https://github.com/corysabol/lookoutitsa.ninja\">here</a>.</p>\n<p>There&#39;s still a lot I want to do with this project such as:</p>\n<ul>\n<li>implement a better night / dark theme</li>\n<li>imporove the CSS styling and overall visual design</li>\n<li>implement non-invasive, non-tracking (no cookies), analytics<ul>\n<li>basically just page views, I may do this with an AWS lambda and some other stuff</li>\n</ul>\n</li>\n<li>and many more fun things</li>\n</ul>\n<p>Thanks for reading, fellow Ninja.</p>\n","slug":"howthiswasmade","file":"howthiswasmade.md"}